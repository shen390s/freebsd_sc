#!/bin/sh

APP=$(basename $0)
REALPATH=$(which realpath)

if [ -z "$REALPATH" ]; then
    REALPATH=$(which grealpath)
fi

_appdir=$(dirname $0)
TOP=$($REALPATH $(cd $_appdir/.. && pwd))

export APP TOP

. $TOP/share/sc/lib/funcs
. $TOP/share/sc/sv/svcs

sc_help() {
    local _c

    printf "usage: %s [-f config ] command [command options] \n" $APP
    for _c in ${sc_commands}; do
	if [ "x$(fn_defined sc_${_c}_help)" = "xyes" ]; then
	    printf "\t - ${_c}\n\t   %s\n" "$(eval sc_${_c}_help)"
	else
	    printf "\t - %s\n" $_c
	fi
    done
}

load_commands

args=$(getopt f:h $*)

if [ $? -ne 0 ]; then
    sc_help
    exit 1
fi

set -- $args

while :; do
    case "$1" in
	-f)
	    _conf=$(realpath "$2")
	    shift 2
	    ;;
	-h)
	    sc_help
	    exit 1
	    ;;
	--)
	    shift
	    break
	    ;;
    esac
	       
done

action="$1"
shift

load_conf "$TOP/etc/sc.conf.default"

test ! -z "$_conf" \
    && load_conf "$_conf" \
    && CONF="$_conf" \
    && export CONF
    
if [ "x$(fn_defined sc_${action})" = "xyes" ]; then
#    set -e
    eval "sc_${action} $@"
else
    if [ ! -z "$action" ]; then
	printf "unknown command: %s\n" $action
	printf "\n"
    fi
    
    sc_help
fi

# Local Variables:
# mode: sh
# End:
