server_services="lockd statd pot nomad"
need_reboot="no"

role_server_install() {
    local _s _d

    for _d in $conf_mountpoint $data_mountpoint; do
	if [ ! -d $_d ]; then
	    run_command mkdir -p $_d
	fi
    done
    
    if [ ! -z "$conf_mountfrom" ]; then
	add_mount "$conf_mountfrom" "$conf_mountpoint" "nfs"
    fi

    if [ ! -z "$data_mountfrom" ]; then
	add_mount "$data_mountfrom" "$data_mountpoint" "nfs"
    fi
    
    for _s in ${server_services}; do
	svc_install "$_s"
    done
}

role_server_config() {
    local _s _role
    
    for _s in ${server_services}; do
	svc_config "$_s"
	svc_enable "$_s"
    done

    #    run_command mount -a
    
    for _s in ${server_services}; do
	svc_start "$_s"
    done

    run_command mount -a

    if master; then
	for _role in consul traefik; do
	    echo make role $_role...
	    if check_image "$_role" "1.0"; then
		:
	    else
		build_image "$_role" "1.0"
		export_image "$_role" "1.0"
	    fi
	    
	    deploy_image "$_role" "1.0" 
	done
    fi
}

role_server_start() {
    local _role

    if is_master; then
	echo "Start pots: consul & traefik on master..."
	
	for _role in consul traefik; do
	    run_command pot stop -p "$_role"
	    run_command pot  start -p "$_role"
	done
    fi
}

# Local Variables:
# mode: sh
# End:
